{% extends 'base.html' %}
{% block title %}Digi Kul - Educational Platform{% endblock %}

{% block content %}
<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">

<!-- Hero Section -->
<div class="hero-section bg-primary text-white py-5">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6">
                <h1 class="display-4 fw-bold mb-4">Welcome to Digi Kul</h1>
                <p class="lead mb-4">
                    The modern educational platform that connects teachers and students 
                    through interactive live sessions, comprehensive quizzes, and collaborative learning.
                </p>
                <div class="d-flex gap-3">
                    <button onclick="showInstitutionSelection()" class="btn btn-light btn-lg">
                        <i class="bi bi-person-plus me-2"></i>Get Started
                    </button>
                    <button onclick="showInstitutionSelection()" class="btn btn-outline-light btn-lg">
                        <i class="bi bi-box-arrow-in-right me-2"></i>Sign In
                    </button>
                </div>
            </div>
            <div class="col-lg-6 text-center">
                <div class="hero-image">
                    <i class="bi bi-mortarboard-fill" style="font-size: 8rem; opacity: 0.8;"></i>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Institution Selection Modal -->
<div class="modal fade" id="institutionModal" tabindex="-1" aria-labelledby="institutionModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="institutionModalLabel">
                    <i class="bi bi-building me-2"></i>Select Your Institution
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row" id="institutionsContainer">
                    <div class="col-12 text-center">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading institutions...</span>
                        </div>
                        <p class="mt-3 text-muted">Loading institutions...</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <div class="d-flex justify-content-between w-100">
                    <a href="/super-admin/login" class="btn btn-outline-danger">
                        <i class="bi bi-shield-check me-2"></i>Super Admin Login
                    </a>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Features Section -->
<div class="container py-5">
    <div class="row">
        <div class="col-12 text-center mb-5">
            <h2 class="display-5 fw-bold">Why Choose Digi Kul?</h2>
            <p class="lead text-muted">Experience the future of education with our comprehensive platform</p>
        </div>
    </div>

    <div class="row g-4">
        <div class="col-md-4">
            <div class="card feature-card h-100 text-center">
                <div class="card-body">
                    <div class="feature-icon mb-3">
                        <i class="bi bi-camera-video text-primary" style="font-size: 3rem;"></i>
                    </div>
                    <h5 class="card-title">Live Sessions</h5>
                    <p class="card-text text-muted">
                        Conduct interactive live lectures with real-time recording, 
                        chat, and participant engagement tools.
                    </p>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card feature-card h-100 text-center">
                <div class="card-body">
                    <div class="feature-icon mb-3">
                        <i class="bi bi-question-circle text-success" style="font-size: 3rem;"></i>
                    </div>
                    <h5 class="card-title">Smart Quizzes</h5>
                    <p class="card-text text-muted">
                        Create comprehensive quizzes with analytics, 
                        time limits, and detailed performance tracking.
                    </p>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card feature-card h-100 text-center">
                <div class="card-body">
                    <div class="feature-icon mb-3">
                        <i class="bi bi-file-earmark-text text-info" style="font-size: 3rem;"></i>
                    </div>
                    <h5 class="card-title">Resource Management</h5>
                    <p class="card-text text-muted">
                        Upload, organize, and share learning materials 
                        with automatic compression and secure access.
                    </p>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card feature-card h-100 text-center">
                <div class="card-body">
                    <div class="feature-icon mb-3">
                        <i class="bi bi-people text-warning" style="font-size: 3rem;"></i>
                    </div>
                    <h5 class="card-title">Cohort Management</h5>
                    <p class="card-text text-muted">
                        Organize students into learning groups with 
                        institution-based access control and management.
                    </p>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card feature-card h-100 text-center">
                <div class="card-body">
                    <div class="feature-icon mb-3">
                        <i class="bi bi-graph-up text-danger" style="font-size: 3rem;"></i>
                    </div>
                    <h5 class="card-title">Analytics & Reports</h5>
                    <p class="card-text text-muted">
                        Get detailed insights into student performance, 
                        attendance, and engagement with visual analytics.
                    </p>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card feature-card h-100 text-center">
                <div class="card-body">
                    <div class="feature-icon mb-3">
                        <i class="bi bi-shield-check text-dark" style="font-size: 3rem;"></i>
                    </div>
                    <h5 class="card-title">Secure & Reliable</h5>
                    <p class="card-text text-muted">
                        Enterprise-grade security with encrypted data, 
                        secure authentication, and privacy protection.
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- User Types Section -->
<div class="bg-light py-5">
    <div class="container">
        <div class="row">
            <div class="col-12 text-center mb-5">
                <h2 class="display-5 fw-bold">Choose Your Role</h2>
                <p class="lead text-muted">Join our educational community</p>
            </div>
        </div>

        <div class="row g-4">
            <div class="col-md-4">
                <div class="card user-type-card h-100 text-center">
                    <div class="card-body">
                        <div class="user-icon mb-3">
                            <i class="bi bi-mortarboard-fill text-primary" style="font-size: 4rem;"></i>
                        </div>
                        <h4 class="card-title">For Students</h4>
                        <p class="card-text text-muted mb-4">
                            Join live lectures, take quizzes, access learning materials, 
                            and track your progress in a collaborative environment.
                        </p>
                        <ul class="list-unstyled text-start">
                            <li><i class="bi bi-check-circle text-success me-2"></i>Join live sessions</li>
                            <li><i class="bi bi-check-circle text-success me-2"></i>Take interactive quizzes</li>
                            <li><i class="bi bi-check-circle text-success me-2"></i>Access learning materials</li>
                            <li><i class="bi bi-check-circle text-success me-2"></i>Track your progress</li>
                            <li><i class="bi bi-check-circle text-success me-2"></i>Connect with peers</li>
                        </ul>
                        <button onclick="showInstitutionSelection()" class="btn btn-primary">
                            <i class="bi bi-person-plus me-2"></i>Join as Student
                        </button>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card user-type-card h-100 text-center">
                    <div class="card-body">
                        <div class="user-icon mb-3">
                            <i class="bi bi-person-badge-fill text-success" style="font-size: 4rem;"></i>
                        </div>
                        <h4 class="card-title">For Teachers</h4>
                        <p class="card-text text-muted mb-4">
                            Create engaging lectures, manage cohorts, conduct quizzes, 
                            and monitor student performance with comprehensive tools.
                        </p>
                        <ul class="list-unstyled text-start">
                            <li><i class="bi bi-check-circle text-success me-2"></i>Create live lectures</li>
                            <li><i class="bi bi-check-circle text-success me-2"></i>Manage student cohorts</li>
                            <li><i class="bi bi-check-circle text-success me-2"></i>Design quizzes & tests</li>
                            <li><i class="bi bi-check-circle text-success me-2"></i>Upload resources</li>
                            <li><i class="bi bi-check-circle text-success me-2"></i>Track student progress</li>
                        </ul>
                        <button onclick="showInstitutionSelection()" class="btn btn-success">
                            <i class="bi bi-person-plus me-2"></i>Join as Teacher
                        </button>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card user-type-card h-100 text-center">
                    <div class="card-body">
                        <div class="user-icon mb-3">
                            <i class="bi bi-shield-check-fill text-warning" style="font-size: 4rem;"></i>
                        </div>
                        <h4 class="card-title">For Administrators</h4>
                        <p class="card-text text-muted mb-4">
                            Manage institutions, oversee cohorts, monitor system health, 
                            and ensure smooth operation of the educational platform.
                        </p>
                        <ul class="list-unstyled text-start">
                            <li><i class="bi bi-check-circle text-success me-2"></i>Manage institutions</li>
                            <li><i class="bi bi-check-circle text-success me-2"></i>Oversee cohorts</li>
                            <li><i class="bi bi-check-circle text-success me-2"></i>Monitor system health</li>
                            <li><i class="bi bi-check-circle text-success me-2"></i>User management</li>
                            <li><i class="bi bi-check-circle text-success me-2"></i>Analytics & reports</li>
                        </ul>
                        <a href="/super-admin/login" class="btn btn-warning">
                            <i class="bi bi-box-arrow-in-right me-2"></i>Admin Login
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Statistics Section -->
<div class="container py-5">
    <div class="row text-center">
        <div class="col-md-3">
            <div class="stat-item">
                <i class="bi bi-people-fill text-primary" style="font-size: 3rem;"></i>
                <h3 class="fw-bold mt-3" id="totalUsers">0</h3>
                <p class="text-muted">Active Users</p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-item">
                <i class="bi bi-building text-success" style="font-size: 3rem;"></i>
                <h3 class="fw-bold mt-3" id="totalInstitutions">0</h3>
                <p class="text-muted">Institutions</p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-item">
                <i class="bi bi-calendar-check text-info" style="font-size: 3rem;"></i>
                <h3 class="fw-bold mt-3" id="totalLectures">0</h3>
                <p class="text-muted">Live Sessions</p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-item">
                <i class="bi bi-question-circle-fill text-warning" style="font-size: 3rem;"></i>
                <h3 class="fw-bold mt-3" id="totalQuizzes">0</h3>
                <p class="text-muted">Quizzes Created</p>
            </div>
        </div>
    </div>
</div>

<!-- CTA Section -->
<div class="bg-primary text-white py-5">
    <div class="container text-center">
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <h2 class="display-5 fw-bold mb-4">Ready to Transform Education?</h2>
                <p class="lead mb-4">
                    Join thousands of educators and students who are already using Digi Kul 
                    to create engaging and effective learning experiences.
                </p>
                <div class="d-flex justify-content-center gap-3 flex-wrap">
                    <button onclick="showInstitutionSelection()" class="btn btn-light btn-lg">
                        <i class="bi bi-rocket-takeoff me-2"></i>Start Your Journey
                    </button>
                    <button onclick="showInstitutionSelection()" class="btn btn-outline-light btn-lg">
                        <i class="bi bi-box-arrow-in-right me-2"></i>Sign In
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Footer -->
<footer class="bg-dark text-white py-4">
    <div class="container">
        <div class="row">
            <div class="col-md-6">
                <h5>Digi Kul Portal</h5>
                <p class="text-muted">
                    Empowering education through technology. 
                    Connect, learn, and grow with our comprehensive platform.
                </p>
            </div>
            <div class="col-md-6 text-md-end">
                <div class="social-links">
                    <a href="#" class="text-white me-3"><i class="bi bi-facebook"></i></a>
                    <a href="#" class="text-white me-3"><i class="bi bi-twitter"></i></a>
                    <a href="#" class="text-white me-3"><i class="bi bi-linkedin"></i></a>
                    <a href="#" class="text-white"><i class="bi bi-github"></i></a>
                </div>
                <p class="text-muted mt-3 mb-0">
                    &copy; 2024 Digi Kul Portal. All rights reserved.
                </p>
            </div>
        </div>
    </div>
</div>

<script>
// Animate statistics on scroll
document.addEventListener('DOMContentLoaded', function() {
    // Animate statistics
    animateStats();
    
    // Add scroll animations
    addScrollAnimations();
    
    // Load institutions for modal
    loadInstitutions();
});

function showInstitutionSelection() {
    const modal = new bootstrap.Modal(document.getElementById('institutionModal'));
    modal.show();
    loadInstitutions(); // Load institutions when modal opens
}

async function loadInstitutions() {
    try {
        const response = await fetch('/api/public/institutions');
        const data = await response.json();
        
        console.log('Loading institutions for index page:', data);
        
        const container = document.getElementById('institutionsContainer');
        
        if (data.success && data.institutions && data.institutions.length > 0) {
            container.innerHTML = '';
            
            data.institutions.forEach(institution => {
                const institutionCard = createInstitutionCard(institution);
                container.appendChild(institutionCard);
            });
        } else {
            container.innerHTML = `
                <div class="col-12 text-center">
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle me-2"></i>
                        No institutions available at the moment.
                    </div>
                </div>
            `;
        }
    } catch (error) {
        console.error('Error loading institutions:', error);
        document.getElementById('institutionsContainer').innerHTML = `
            <div class="col-12 text-center">
                <div class="alert alert-danger">
                    <i class="bi bi-exclamation-triangle me-2"></i>
                    Failed to load institutions. Please try again later.
                </div>
            </div>
        `;
    }
}

function createInstitutionCard(institution) {
    const col = document.createElement('div');
    col.className = 'col-md-6 col-lg-4 mb-3';
    
    col.innerHTML = `
        <div class="card institution-card h-100">
            <div class="card-header text-center" style="background: linear-gradient(135deg, ${institution.primary_color || '#667eea'} 0%, ${institution.secondary_color || '#764ba2'} 100%); color: white;">
                <div class="institution-logo mb-2">
                    ${institution.logo_url ? 
                        `<img src="${institution.logo_url}" alt="${institution.name}" style="width: 50px; height: 50px; border-radius: 50%; object-fit: cover;" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                         <i class="bi bi-building" style="display: none; font-size: 2rem;"></i>` :
                        '<i class="bi bi-building" style="font-size: 2rem;"></i>'
                    }
                </div>
                <h6 class="mb-0">${institution.name}</h6>
            </div>
            <div class="card-body text-center">
                <p class="card-text text-muted small">${institution.description || 'Educational excellence and innovation.'}</p>
                <div class="d-grid gap-2">
                    <a href="/institution/${institution.subdomain}/login" class="btn btn-primary btn-sm">
                        <i class="bi bi-box-arrow-in-right me-1"></i>Login
                    </a>
                    <a href="/institution/${institution.subdomain}/register" class="btn btn-outline-primary btn-sm">
                        <i class="bi bi-person-plus me-1"></i>Register
                    </a>
                </div>
            </div>
        </div>
    `;
    
    return col;
}

function animateStats() {
    const stats = [
        { id: 'totalUsers', target: 1250 },
        { id: 'totalInstitutions', target: 45 },
        { id: 'totalLectures', target: 320 },
        { id: 'totalQuizzes', target: 890 }
    ];
    
    stats.forEach(stat => {
        animateCounter(stat.id, stat.target);
    });
}

function animateCounter(elementId, target) {
    const element = document.getElementById(elementId);
    let current = 0;
    const increment = target / 100;
    const timer = setInterval(() => {
        current += increment;
        if (current >= target) {
            current = target;
            clearInterval(timer);
        }
        element.textContent = Math.floor(current).toLocaleString();
    }, 20);
}

function addScrollAnimations() {
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    });
    
    // Observe all cards
    document.querySelectorAll('.feature-card, .user-type-card').forEach(card => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(30px)';
        card.style.transition = 'all 0.6s ease';
        observer.observe(card);
    });
}

// Smooth scrolling for anchor links
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
            target.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }
    });
});
</script>

<style>
.hero-section {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 60vh;
    display: flex;
    align-items: center;
}

.hero-image {
    animation: float 3s ease-in-out infinite;
}

@keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-20px); }
}

.feature-card {
    border: none;
    border-radius: 15px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
}

.feature-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}

.user-type-card {
    border: none;
    border-radius: 15px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
}

.user-type-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}

.institution-card {
    border: none;
    border-radius: 10px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
}

.institution-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.stat-item {
    padding: 2rem 1rem;
    transition: all 0.3s ease;
}

.stat-item:hover {
    transform: scale(1.05);
}

.feature-icon, .user-icon {
    transition: all 0.3s ease;
}

.feature-card:hover .feature-icon,
.user-type-card:hover .user-icon {
    transform: scale(1.1);
}

.btn {
    border-radius: 25px;
    padding: 0.75rem 2rem;
    font-weight: 600;
    transition: all 0.3s ease;
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.social-links a {
    font-size: 1.5rem;
    transition: all 0.3s ease;
}

.social-links a:hover {
    transform: translateY(-3px);
    color: #667eea !important;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .hero-section {
        min-height: 50vh;
        text-align: center;
    }
    
    .display-4 {
        font-size: 2.5rem;
    }
    
    .display-5 {
        font-size: 2rem;
    }
    
    .btn-lg {
        padding: 0.5rem 1.5rem;
        font-size: 1rem;
    }
}

/* Loading animation for statistics */
@keyframes countUp {
    from { opacity: 0; }
    to { opacity: 1; }
}

.stat-item h3 {
    animation: countUp 0.5s ease-in-out;
}
</style>
{% endblock %}